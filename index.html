<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Setup Adjuster</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#DC2626',
                        'secondary': '#1F2937',
                        'card-bg': '#374151',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #DC2626; border-radius: 4px; }
        ::-webkit-scrollbar-track { background: #1F2937; }
        input:focus { --tw-ring-color: #DC2626; }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            border: 1px solid #DC2626;
            height: 16px; width: 16px;
            border-radius: 50%;
            background: #DC2626;
            cursor: pointer;
            box-shadow: 0 0 2px 0 #DC2626;
        }
        input[type=range]::-moz-range-thumb {
            border: 1px solid #DC2626;
            height: 16px; width: 16px;
            border-radius: 50%;
            background: #DC2626;
            cursor: pointer;
            box-shadow: 0 0 2px 0 #DC2626;
        }

        .base-range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px; width: 12px;
            border-radius: 50%;
            background: #4B5563;
            cursor: pointer;
        }
        .base-range-input::-moz-range-thumb {
            height: 12px; width: 12px;
            border-radius: 50%;
            background: #4B5563;
            cursor: pointer;
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] { -moz-appearance: textfield; }

        .setup-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 1rem;
        }
        @media (min-width: 768px) {
            .setup-grid {
                grid-template-columns: repeat(6, minmax(0, 1fr));
                gap: 1.5rem;
            }
        }
    </style>
</head>
<body class="bg-secondary text-gray-100 min-h-screen p-4 sm:p-8 font-sans">
    <div class="max-w-6xl mx-auto text-center">
        
<header class="text-center mb-4">
  <div class="flex justify-center mb-6 space-x-4">
    <button id="tab-setup" class="px-4 py-2 font-semibold text-white bg-primary rounded-lg shadow hover:bg-primary/80">Setup Tool</button>
    <button id="tab-training" class="px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-lg shadow hover:bg-gray-600">Training Sim</button>
  </div>
</header>

            
        </header>

        <div class="bg-card-bg p-6 sm:p-8 rounded-xl shadow-2xl space-y-8">

<h1 class="text-4xl sm:text-5xl font-extrabold text-primary mb-2 ">Setup Tool v1.2</h1>
            
            <!-- DATA SOURCE SELECTOR -->
            <section class="mb-6">
                <label for="data-source" class="block text-sm font-medium text-gray-300 mb-2">Data Source</label>
                <select id="data-source" class="w-full sm:w-64 bg-gray-700 text-white rounded-md p-2 border border-gray-600 focus:border-primary focus:ring-1 focus:ring-primary">
                    <option value="STRATITA" selected>Stratita</option>
                    <option value="GARAGE">Garage</option>
                <option value="AVERAGE">Average</option></select>
            </section>

            <!-- Temperature Adjustments -->
            <section>
                <h2 class="text-2xl font-semibold mb-4 border-b border-gray-600 pb-2 text-white">1. Temperature Adjustments</h2>

                <div class="mb-6 p-4 bg-gray-700 rounded-lg">
                    <label for="temp-input" class="block text-sm font-medium text-gray-300 mb-2">
                        Temperature Change: <span id="temp-display" class="text-2xl font-bold text-primary">0</span> °C
                    </label>
                    <input type="range" id="temp-input" min="-20" max="20" value="0"
                        class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer range-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50">
                    <div class="flex justify-between text-xs text-gray-400 mt-2">
                        <span>-1 °C</span><span>Baseline</span><span>+1 °C</span>
                    </div>
                </div>

                <div class="p-4 rounded-xl bg-gray-800 shadow-inner mb-6">
                    <h3 class="text-lg font-bold text-white mb-3">Temperature Adjustment per Component</h3>
                    <div class="p-3 rounded-lg bg-gray-700 flex flex-wrap md:flex-nowrap">
                        <span class="text-sm font-bold text-white w-full md:w-1/6 self-center mb-2 md:mb-0">Temp Adj. (<span id="temp-adj-val-2">0</span> °C)</span>
                        <div id="temp-adj-row" class="setup-grid w-full md:w-5/6"></div>
                    </div>
                </div>

                <!-- Surface Change Buttons -->
                <div class="p-4 rounded-xl bg-gray-800 shadow-inner mb-6">
                    <h3 class="text-lg font-bold text-white mb-3">Track Surface Change</h3>
                    <div class="flex flex-col md:flex-row rounded-lg shadow-sm w-full space-y-2 md:space-y-0 md:space-x-0">
                        <button id="surface-neutral" data-surface="NEUTRAL"
                            class="flex-1 px-3 py-2 text-sm font-medium border border-primary text-white bg-primary rounded-lg md:rounded-l-lg md:rounded-r-none">
                            Base Setup
                        </button>
                        <button id="surface-dry-to-rain" data-surface="DRY_TO_RAIN"
                            class="flex-1 px-3 py-2 text-sm font-medium border border-gray-500 text-gray-300 hover:bg-gray-800 rounded-lg md:rounded-none">
                            Dry to Rain Conversion
                        </button>
                        <button id="surface-rain-to-dry" data-surface="RAIN_TO_DRY"
                            class="flex-1 px-3 py-2 text-sm font-medium border border-gray-500 text-gray-300 hover:bg-gray-800 rounded-lg md:rounded-r-lg md:rounded-l-none">
                            Rain to Dry Conversion
                        </button>
                    </div>
                </div>

                <div class="p-4 rounded-xl bg-gray-800 shadow-inner">
                    <h3 class="text-lg font-bold text-white mb-3">Surface Condition Adjustment per Component</h3>
                    <div class="p-3 rounded-lg bg-gray-700 flex flex-wrap md:flex-nowrap mb-4">
                        <span class="text-sm font-bold text-white w-full md:w-1/6 self-center mb-2 md:mb-0">Surface Adj.</span>
                        <div id="surface-adj-row" class="setup-grid w-full md:w-5/6"></div>
                    </div>
                    <div class="p-3 rounded-lg bg-primary/30 border border-primary/50 flex flex-wrap md:flex-nowrap">
                        <span class="text-sm font-bold text-white w-full md:w-1/6 self-center mb-2 md:mb-0">Total C° and Surface Adj.</span>
                        <div id="total-adj-row" class="setup-grid w-full md:w-5/6"></div>
                    </div>
                </div>
            </section>

            <section class="mt-8">
                <h2 class="text-2xl font-semibold mb-4 border-b border-gray-600 pb-2 text-white">2. Base Setup & Final Recommendation</h2>
                <div class="p-4 rounded-xl bg-gray-700/50 border border-gray-600 mb-6">
                    <h3 class="text-base font-bold text-white mb-3 border-b border-gray-600 pb-2">Your Base Setup</h3>
                    <div id="base-input-row" class="setup-grid"></div>
                </div>

                <div class="p-4 rounded-xl bg-gray-800 shadow-inner">
                    <h3 class="text-xl font-bold text-white mb-4">New Recommended Setup</h3>
                    <div class="p-3 rounded-lg bg-primary/20 border-2 border-primary flex flex-wrap md:flex-nowrap">
                        <span class="text-lg font-bold text-white w-full md:w-1/6 self-center mb-2 md:mb-0">Final Setup</span>
                        <div id="new-setup-row" class="setup-grid w-full md:w-5/6"></div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // === DATASETS ===
        const STRATITA = {
            COEFFS: {
                'Front wing': 4.17, 'Rear wing': 4.17, 'Engine': -5.00, 'Brakes': 5.83, 'Gear': -5.00, 'Suspension': -5.50
            },
            DRY_TO_RAIN: {
                'Front wing': 115.0, 'Rear wing': 115.0, 'Engine': -105.0, 'Brakes': 85.0, 'Gear': -100.0, 'Suspension': -120.0
            },
            RAIN_TO_DRY: {
                'Front wing': -115.0, 'Rear wing': -115.0, 'Engine': 105.0, 'Brakes': -85.0, 'Gear': 100.0, 'Suspension': 120.0
            }
        };

        const GARAGE = {
            COEFFS: {
                'Front wing': 5.0, 'Rear wing': 5.0, 'Engine': -3.0, 'Brakes': 6.0, 'Gear': -4.0, 'Suspension': -6.0
            },
            DRY_TO_RAIN: {
                'Front wing': 185.0, 'Rear wing': 185.0, 'Engine': -217.0, 'Brakes': 101.0, 'Gear': -17.0, 'Suspension': -253.0
            },
            RAIN_TO_DRY: {
                'Front wing': -185.0, 'Rear wing': -185.0, 'Engine': 217.0, 'Brakes': -101.0, 'Gear': 17.0, 'Suspension': 253.0
            }
        };

// === AVERAGE derived dataset ===
function computeAverageDataset(a, b) {
  const avg = {};
  for (const key in a) {
    if (typeof a[key] === 'object') {
      avg[key] = computeAverageDataset(a[key], b[key]);
    } else {
      avg[key] = (a[key] + b[key]) / 2;
    }
  }
  return avg;
}
const AVERAGE = computeAverageDataset(STRATITA, GARAGE);


        // === STATE ===
        let currentDataSet = 'STRATITA';
        let currentSurface = 'NEUTRAL';
        const setupParts = Object.keys(STRATITA.COEFFS);
        const tempInput = document.getElementById('temp-input');
        const tempDisplay = document.getElementById('temp-display');

        // === FUNCTIONS ===
        const formatAdjustment = (v) => {
            const r = Math.round(v * 100) / 100;
            return r > 0 ? `+${r.toFixed(2)}` : r.toFixed(2);
        };
        const clampValue = (v) => Math.max(0, Math.min(1000, v));

        function getActiveDataSet() {
            if (currentDataSet === 'GARAGE') return GARAGE;
            if (currentDataSet === 'AVERAGE') return AVERAGE;
            return STRATITA;
        }

        function handleBaseInputChange(e) {
            const part = e.target.getAttribute('data-part');
            const safeId = part.replace(/\s/g, '-').toLowerCase();
            let val = parseFloat(e.target.value);
            val = isNaN(val) ? 0 : clampValue(val);

            const text = document.getElementById(`base-text-input-${safeId}`);
            const range = document.getElementById(`base-range-input-${safeId}`);

            if (e.target.classList.contains('base-text-input')) {
                range.value = val;
                if (parseFloat(text.value) !== val) text.value = val.toFixed(0);
            } else text.value = val.toFixed(0);

            updateCalculations();
        }

        function renderInitialSetup() {
            const baseInputRow = document.getElementById('base-input-row');
            const tempAdjRow = document.getElementById('temp-adj-row');
            const surfaceAdjRow = document.getElementById('surface-adj-row');
            const totalAdjRow = document.getElementById('total-adj-row');
            const newSetupRow = document.getElementById('new-setup-row');

            baseInputRow.innerHTML = tempAdjRow.innerHTML = surfaceAdjRow.innerHTML = totalAdjRow.innerHTML = newSetupRow.innerHTML = '';

            setupParts.forEach(part => {
                const safeId = part.replace(/\s/g, '-').toLowerCase();

                baseInputRow.innerHTML += `
                    <div class="flex flex-col items-center space-y-1">
                        <span class="text-xs font-medium text-gray-400 uppercase truncate">${part}</span>
                        <input type="number" data-part="${part}" value="500" min="0" max="1000" id="base-text-input-${safeId}"
                            class="base-text-input w-full p-1 text-base bg-gray-600 text-white rounded-md border border-gray-500 text-center font-mono focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none">
                        <input type="range" data-part="${part}" value="500" min="0" max="1000" id="base-range-input-${safeId}"
                            class="base-range-input w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                `;
                tempAdjRow.innerHTML += `<div class="flex flex-col items-center"><span class="text-xs text-gray-400">${part}</span><span id="temp-adj-${safeId}" class="text-sm font-mono text-yellow-300">0.00</span></div>`;
                surfaceAdjRow.innerHTML += `<div class="flex flex-col items-center"><span class="text-xs text-gray-400">${part}</span><span id="surface-adj-${safeId}" class="text-sm font-mono text-blue-400">0.00</span></div>`;
                totalAdjRow.innerHTML += `<div class="flex flex-col items-center"><span class="text-xs text-gray-400">${part}</span><span id="total-adj-${safeId}" class="text-sm font-mono text-yellow-500 font-bold">0.00</span></div>`;
                newSetupRow.innerHTML += `<div class="flex flex-col items-center"><span class="text-xs text-gray-400">${part}</span><span id="new-setup-${safeId}" class="text-md font-bold text-green-400">0.00</span></div>`;
            });

            document.querySelectorAll('.base-text-input, .base-range-input').forEach(i => {
                i.addEventListener('input', handleBaseInputChange);
                i.addEventListener('change', handleBaseInputChange);
            });
        }

        function updateCalculations() {
            const data = getActiveDataSet();
            const deltaT = parseFloat(tempInput.value);
            const tempAdjValDisplay = formatAdjustment(deltaT);
            document.getElementById('temp-adj-val-2').textContent = tempAdjValDisplay;
            tempDisplay.textContent = tempAdjValDisplay;

            let surfaceAdjustments = {};
            if (currentSurface === 'DRY_TO_RAIN') surfaceAdjustments = data.DRY_TO_RAIN;
            else if (currentSurface === 'RAIN_TO_DRY') surfaceAdjustments = data.RAIN_TO_DRY;
            else setupParts.forEach(p => surfaceAdjustments[p] = 0);

            setupParts.forEach(part => {
                const safeId = part.replace(/\s/g, '-').toLowerCase();
                const baseVal = parseFloat(document.getElementById(`base-text-input-${safeId}`).value) || 0;
                const tempAdj = data.COEFFS[part] * deltaT;
                const surfAdj = surfaceAdjustments[part] || 0;
                const totalAdj = tempAdj + surfAdj;
                const newVal = clampValue(baseVal + totalAdj);

                document.getElementById(`temp-adj-${safeId}`).textContent = formatAdjustment(tempAdj);
                document.getElementById(`surface-adj-${safeId}`).textContent = formatAdjustment(surfAdj);
                document.getElementById(`total-adj-${safeId}`).textContent = formatAdjustment(totalAdj);

                const result = document.getElementById(`new-setup-${safeId}`);
                result.textContent = newVal.toFixed(2);
                if (Math.abs(totalAdj) > 20) result.classList.add('animate-pulse'); else result.classList.remove('animate-pulse');
            });
        }

        function setSurface(surface) {
            currentSurface = surface;
            ['surface-neutral','surface-dry-to-rain','surface-rain-to-dry'].forEach(id=>{
                const btn=document.getElementById(id);
                const active=btn.getAttribute('data-surface')===surface;
                btn.className=`flex-1 px-3 py-2 text-sm font-medium rounded-lg border ${active?'bg-primary border-primary text-white':'bg-gray-700 border-gray-500 text-gray-300 hover:bg-gray-800'}`;
            });
            updateCalculations();
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderInitialSetup();
            tempInput.addEventListener('input', updateCalculations);
            document.getElementById('data-source').addEventListener('change', e => {
                currentDataSet = e.target.value;
                updateCalculations();
            });
            document.getElementById('surface-neutral').addEventListener('click', () => setSurface('NEUTRAL'));
            document.getElementById('surface-dry-to-rain').addEventListener('click', () => setSurface('DRY_TO_RAIN'));
            document.getElementById('surface-rain-to-dry').addEventListener('click', () => setSurface('RAIN_TO_DRY'));
            setSurface('NEUTRAL');
        });
    </script>
</body>
</html>
<!-- ====================== TRAINING SIM ====================== -->
<div id="training-sim-page" class="hidden">

<header class="text-center mb-4">
  <div class="flex justify-center mb-6 space-x-4">
    <button id="tab-setup" class="px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-lg shadow hover:bg-gray-600">Setup Tool</button>
    <button id="tab-training" class="px-4 py-2 font-semibold text-white bg-primary rounded-lg shadow hover:bg-primary/80">Training Sim</button>
  </div>
</header>

  <div class="bg-card-bg p-6 sm:p-8 rounded-xl shadow-2xl space-y-8">
    <h2 class="text-3xl font-bold text-primary text-center">Training Sim v1.1</h2>
    <p class="text-center text-gray-300">Input Driver Stats - Choose a Training</p>

    <!-- Input Form -->
    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
        <template id="stat-template">
          <div class="flex flex-col">
            <label class="text-sm text-gray-300 mb-1 font-semibold stat-label"></label>
            <input type="number" class="stat-input w-full bg-gray-700 p-2 rounded-md text-white border border-gray-600 focus:border-primary focus:ring-1 focus:ring-primary" />
          </div>
        </template>
        <div id="stat-container" class="contents"></div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
        <div>
          <label class="text-sm text-gray-300 font-semibold">Training Type</label>
          <select id="training-type" class="w-full bg-gray-700 text-white p-2 rounded-md border border-gray-600">
            <option value="yoga">Yoga</option>
            <option value="fitness">Fitness</option>
            <option value="ninja">Ninja</option>
            <option value="technique">Technique</option>
            <option value="psycho">Psychologie du sport</option>
            <option value="rp">RP</option>
            <option value="spa">Spa resort</option>
          </select>
        </div>
        <div>
          <label class="text-sm text-gray-300 font-semibold">Sessions (1–34)</label>
          <input id="training-times" type="number" min="1" max="34" value="1" class="w-full bg-gray-700 text-white p-2 rounded-md border border-gray-600">
        </div>
        <button id="simulate-btn" class="bg-primary hover:bg-primary/80 text-white font-bold py-2 px-4 rounded-lg shadow-md">Simulate</button>
      </div>
    </div>

    <!-- Results -->
    <div id="results-container" class="hidden bg-gray-800 rounded-lg p-6 shadow-inner">
      <h3 class="text-2xl font-semibold text-center text-white mb-4">Simulation Results</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left text-gray-300 border border-gray-600 rounded-lg">
          <thead class="bg-gray-700 text-gray-200">
            <tr><th class="px-4 py-2">Stat</th><th class="px-4 py-2">Before</th><th class="px-4 py-2">After</th><th class="px-4 py-2">Δ</th></tr>
          </thead>
          <tbody id="results-body" class="divide-y divide-gray-700"></tbody>
        </table>
      </div>
      <div class="text-center mt-4">
        <span id="results-cost" class="inline-block bg-primary/20 border border-primary text-primary font-bold px-4 py-2 rounded-lg"></span>
      </div>
    </div>
  </div>
</div>

<script>
// === Driver Training Simulator ===
const STAT_LIMITS={concentration:[0,250],talent:[0,250],aggressivite:[0,250],experience:[0,250],technical:[0,250],stamina:[0,250],charisme:[0,250],motivation:[0,250],poids:[0,125]};
const TRAININGS={
  yoga:{cost:700000,effects:()=>({concentration:r(4,6),aggressivite:-2,stamina:-2,motivation:r(5,10)})},
  fitness:{cost:750000,effects:()=>({stamina:2,poids:-1,motivation:-3})},
  ninja:{cost:550000,effects:()=>({aggressivite:r(5,7),concentration:1})},
  technique:{cost:600000,effects:()=>({technical:5})},
  psycho:{cost:400000,effects:()=>({motivation:55})},
  rp:{cost:500000,effects:()=>({charisme:5,concentration:-3})},
  spa:{cost:500000,effects:()=>({stamina_mult:1.4,motivation:19})}
};
function r(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function clamp(k,v){const [lo,hi]=STAT_LIMITS[k];return Math.min(Math.max(v,lo),hi);}

// Build stat inputs dynamically
const statContainer = document.getElementById("stat-container");
const template = document.getElementById("stat-template").content;
Object.keys(STAT_LIMITS).forEach(k => {
  const el = template.cloneNode(true);
  el.querySelector(".stat-label").textContent =
    k.charAt(0).toUpperCase() + k.slice(1);
  const input = el.querySelector(".stat-input");
  input.id = "stat-" + k;
  input.min = STAT_LIMITS[k][0];
  input.max = STAT_LIMITS[k][1];
  input.value = k === "poids" ? 75 : 100;
  statContainer.appendChild(el);
});

document.getElementById("simulate-btn").addEventListener("click", () => {
  const type = document.getElementById("training-type").value;
  const times = parseInt(document.getElementById("training-times").value);
  const t = TRAININGS[type];
  if (!t || times < 1 || times > 34) {
    alert("Invalid input");
    return;
  }

  const stats = {};
  Object.keys(STAT_LIMITS).forEach(
    k => (stats[k] = parseFloat(document.getElementById("stat-" + k).value) || 0)
  );

  const before = { ...stats };

  for (let i = 0; i < times; i++) {
    const e = t.effects();
    for (const k in e) {
      if (k.endsWith("_mult")) {
        const base = k.replace("_mult", "");
        stats[base] = clamp(base, Math.round(stats[base] * e[k]));
      } else {
        stats[k] = clamp(k, stats[k] + e[k]);
      }
    }
  }

  const after = { ...stats };
  const tbody = document.getElementById("results-body");
  tbody.innerHTML = "";

  for (const k of Object.keys(before)) {
    const d = after[k] - before[k];
    tbody.innerHTML += `
      <tr>
        <td class="px-4 py-2 capitalize">${k}</td>
        <td class="px-4 py-2">${before[k]}</td>
        <td class="px-4 py-2">${after[k]}</td>
        <td class="px-4 py-2 ${d > 0 ? 'text-green-400' : (d < 0 ? 'text-red-400' : 'text-gray-300')}">
          ${d > 0 ? '+' : ''}${d}
        </td>
      </tr>`;
  }

  document.getElementById("results-cost").textContent =
    `Total Cost: $${(t.cost * times).toLocaleString()}`;
  document.getElementById("results-container").classList.remove("hidden");
});



// === Tabs (fixed for both header sets) ===
const allTabSetups = document.querySelectorAll("#tab-setup");
const allTabTrainings = document.querySelectorAll("#tab-training");
const setupContainer = document.querySelector(".bg-card-bg").parentElement;
const trainingContainer = document.getElementById("training-sim-page");

function switchTab(to) {
  const activeSetup = to === "setup";
  const activeTraining = to === "training";

  allTabSetups.forEach(btn =>
    btn.classList.toggle("bg-primary", activeSetup)
  );
  allTabSetups.forEach(btn =>
    btn.classList.toggle("text-white", activeSetup)
  );
  allTabTrainings.forEach(btn =>
    btn.classList.toggle("bg-primary", activeTraining)
  );
  allTabTrainings.forEach(btn =>
    btn.classList.toggle("text-white", activeTraining)
  );

  if (activeSetup) {
    setupContainer.classList.remove("hidden");
    trainingContainer.classList.add("hidden");
  } else {
    trainingContainer.classList.remove("hidden");
    setupContainer.classList.add("hidden");
  }
}

// Bind listeners to *all* tab buttons
allTabSetups.forEach(btn => btn.addEventListener("click", () => switchTab("setup")));
allTabTrainings.forEach(btn => btn.addEventListener("click", () => switchTab("training")));

</script>
